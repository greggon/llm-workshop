<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LLM Workshop</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<style>
	.toggle {
		cursor: pointer;
		user-select: none; /* Prevent text selection */
	}
	.toggle.collapsed::before {
		content: '▼ ';
		display: inline-block;
		transform: rotate(0deg);
		transition: transform 0.3s ease;
	}
	.toggle::before {
		content: '▼ ';
		display: inline-block;
		transform: rotate(-90deg);
		transition: transform 0.3s ease;
	}
</style>
<body>

<script>
const baseUrl = "https://cloud.blaize.net/llmworkshop"
//const baseUrl = "http://172.24.89.138:5000"
</script>

<div class="container mt-5">
    <!-- Tabs navigation -->
    <ul class="nav nav-tabs">
        <li class="nav-item">
            <a class="nav-link active" aria-current="page" href="#lab1a" data-bs-toggle="tab">Lab 1a</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="#lab1b" data-bs-toggle="tab">Lab 1b</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="#lab2" data-bs-toggle="tab">Lab 2</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="#lab3a" data-bs-toggle="tab">Lab 3a</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="#lab3b" data-bs-toggle="tab">Lab 3b</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="#lab4" data-bs-toggle="tab">Lab 4</a>
        </li>
    </ul>
	<div class="tab-content pt-4">
    <!-- Tabs content -->
       <div class="tab-pane active" id="lab1a">
			
            <h2>Zero-Shot Prompt: Inspirational Quote Generator</h2>
            <div class="mb-3">
                <label for="quotePrompt" class="form-label">Enter your prompt:</label>
                <input type="text" class="form-control" id="quotePrompt" placeholder="Describe your quote.">
            </div>
            <button class="btn btn-primary" onclick="fetchQuote()">Get Quote</button>
            <p id="quoteDisplay" class="mt-3"></p>

			<script>
				function fetchQuote() {
					const prompt = document.getElementById('quotePrompt').value;
					if (!prompt) {
						alert('Please enter a prompt.');
						return;
					}
					
					fetch(baseUrl + '/quote', {
						method: 'POST',
						headers: {
							'Content-Type': 'application/json',
						},
						body: JSON.stringify({ prompt: prompt }),
					})
					.then(response => response.json())
					.then(data => {
						if (data.error) {
							document.getElementById('quoteDisplay').textContent = 'Error: ' + data.error;
						} else {
							// Create a table and populate it with data
							const resultsContainer = document.getElementById('quoteDisplay');
							resultsContainer.innerHTML = data.quote; // Clear previous results
						}
					})
					.catch(error => {
						console.error('Error:', error);
						document.getElementById('quoteDisplay').textContent = 'An error occurred while fetching the quote results.';
					});
					
				}
			</script>

				
        </div>			
	

        <div class="tab-pane" id="lab1b">
			
            <h2>Text Summarization: Summarize a Wikipedia Article</h2>
            <div class="mb-3">
                <input type="text" id="articleUrl" class="form-control" placeholder="Enter Wikipedia Article URL">
            </div>
            <div class="mb-3">
                <textarea id="wikiPrompt" class="form-control" rows="4" placeholder="How do you want to summarize this article?"></textarea>
            </div>
            <button class="btn btn-primary" onclick="summarizeArticle()">Summarize</button>
            <h3 class="mt-4">Summary:</h3>
            <div id="summary"></div>

			<script>
				function summarizeArticle() {
					const url = document.getElementById('articleUrl').value;
					const prompt = document.getElementById('wikiPrompt').value;
					if (!url||!prompt) {
						alert('Please enter a Wikipedia article URL  and Prompt.');
						return;
					}
					
					fetch(`${baseUrl}/summarize?url=${encodeURIComponent(url)}&prompt=${prompt}`)
						.then(response => response.json())
						.then(data => {
							if (data.error) {
								document.getElementById('summary').textContent = 'Error: ' + data.error;
							} else {
								document.getElementById('summary').textContent = `Title: ${data.title}\n\nSummary: ${data.summary}`;
							}
						})
						.catch(error => {
							console.error('Error:', error);
							document.getElementById('summary').textContent = 'An error occurred while fetching the summary.';
						});
				}
			</script>

				
        </div>
		
        <div class="tab-pane" id="lab2">
		
            <h2>Natural Language to SQL (NL2SQL)</h2>
            <div class="mb-3">
                <textarea class="form-control" id="questionText" rows="4" placeholder="Enter your question here about Jeopary..."></textarea>
            </div>
            <button class="btn btn-primary" onclick="askQuestion()">Submit Question</button>
            <h3 class="mt-4">Results:</h3>
            <div id="queryResults"></div>

			<script>
				function askQuestion() {
					const question = document.getElementById('questionText').value;
					if (!question) {
						alert('Please enter a question.');
						return;
					}

					fetch(baseUrl + '/ask_question', {
						method: 'POST',
						headers: {
							'Content-Type': 'application/json',
						},
						body: JSON.stringify({ question: question }),
					})
					.then(response => response.json())
					.then(data => {
						if (data.error) {
							document.getElementById('queryResults').textContent = 'Error: ' + data.error;
						} else {
							displayResults(data);
						}
					})
					.catch(error => {
						console.error('Error:', error);
						document.getElementById('queryResults').textContent = 'An error occurred while fetching the query results.';
					});
				}

				function displayResults(data) {
					const resultsContainer = document.getElementById('queryResults');
					resultsContainer.innerHTML = ''; // Clear previous results

					if (data.length === 0) {
						resultsContainer.innerHTML = '<p>No results found.</p>';
						return;
					}

					const table = document.createElement('table');
					table.setAttribute('border', '1');
					table.style.width = '100%';
					table.style.borderCollapse = 'collapse';
					table.classList.add("table");
					

					const thead = table.createTHead();
					const headerRow = thead.insertRow();
					const headers = ['Show Number', 'Air Date', 'Round', 'Category', 'Value', 'Question', 'Answer'];
					headers.forEach(headerText => {
						const headerCell = document.createElement('th');
						headerCell.textContent = headerText;
						headerRow.appendChild(headerCell);
					});

					const tbody = table.createTBody();
					data.forEach(item => {
						const row = tbody.insertRow();
						const cellData = [
							item.ShowNumber,
							item.AirDate ? new Date(item.AirDate).toLocaleDateString() : 'N/A',
							item.Round,
							item.Category,
							`$${item.Value}`,
							item.Question, // Will handle HTML content in the next step
							item.Answer
						];
						cellData.forEach((cellText, index) => {
							const cell = row.insertCell();
							if (index === 5) { // Assuming the Question field might contain HTML links
								cell.innerHTML = cellText;
							} else {
								cell.textContent = cellText;
							}
						});
					});

					resultsContainer.appendChild(table);
				}
			</script>	
		</div>		
        <div class="tab-pane" id="lab3a">
		
            <h2>Vector Search</h2>
            <div class="mb-3">
                <input type="text" class="form-control" id="searchQuery" placeholder="Enter your question here about Jeopary...">
            </div>
            <button class="btn btn-primary" onclick="performSearch()">Search</button>
            <h3 class="mt-4">Results:</h3>
            <div id="searchResults"></div>

			<script>
				function performSearch() {
					const query = document.getElementById('searchQuery').value;
					if (!query) {
						alert('Please enter a search query.');
						return;
					}

					fetch(baseUrl + '/vectorsearch', {
						method: 'POST',
						headers: {
							'Content-Type': 'application/json',
						},
						body: JSON.stringify({ query: query }),
					})
					.then(response => response.json())
					.then(data => {
						if (data.error) {
							document.getElementById('searchResults').textContent = 'Error: ' + data.error;
						} else {
							// Create a table and populate it with data
							const table = createTable(data);
							const resultsContainer = document.getElementById('searchResults');
							resultsContainer.innerHTML = ''; // Clear previous results
							resultsContainer.appendChild(table);
						}
					})
					.catch(error => {
						console.error('Error:', error);
						document.getElementById('searchResults').textContent = 'An error occurred while fetching the search results.';
					});
				}

				function createTable(data) {
					const table = document.createElement('table');
					table.setAttribute('border', '1');
					table.style.width = '100%';
					table.style.borderCollapse = 'collapse';

					// Create table header
					const thead = table.createTHead();
					const headerRow = thead.insertRow();
					const headers = ['Category', 'Question', 'Answer', 'Round', 'Show Number'];
					headers.forEach(headerText => {
						const headerCell = document.createElement('th');
						headerCell.textContent = headerText;
						headerRow.appendChild(headerCell);
					});

					// Populate table body
					const tbody = table.createTBody();
					data.forEach(item => {
						const row = tbody.insertRow();
						const cellData = [item.Category, item.Question, item.Answer, item.Round, item.ShowNumber];
						cellData.forEach(cellText => {
							const cell = row.insertCell();
							cell.textContent = cellText;
						});
					});

					return table;
				}
			</script>

        </div>
        <div class="tab-pane" id="lab3b">
		
            <h2>Retrieval Augmented Generation (RAG) App</h2>
            <div class="mb-3">
                <textarea class="form-control" id="resumeText" rows="4" placeholder="Enter your question about resumes here..."></textarea>
            </div>
            <button class="btn btn-primary" onclick="searchResumes()">Submit Question</button>
            <h3 class="mt-4">Results:</h3>
            <div id="resumeResults"></div>

			<script>
				function searchResumes() {
					const question = document.getElementById('resumeText').value;
					if (!question) {
						alert('Please enter a question.');
						return;
					}

					fetch(baseUrl + '/rag', {
						method: 'POST',
						headers: {
							'Content-Type': 'application/json',
						},
						body: JSON.stringify({ query: question }),
					})
					.then(response => response.json())
					.then(data => {
						if (data.error) {
							document.getElementById('resumeResults').textContent = 'Error: ' + data.error;
						} else {
							displayResumes(data);
						}
					})
					.catch(error => {
						console.error('Error:', error);
						document.getElementById('resumeResults').textContent = 'An error occurred while fetching the query results.';
					});
				}

				function displayResumes(data) {
					const resultsContainer = document.getElementById('resumeResults');
					resultsContainer.innerHTML = ''; // Clear previous results

					if (data.length === 0) {
						resultsContainer.innerHTML = '<p>No results found.</p>';
						return;
					}

					const table = document.createElement('table');
					table.setAttribute('border', '1');
					table.style.width = '100%';
					table.style.borderCollapse = 'collapse';
					table.classList.add("table");

					const thead = table.createTHead();
					const headerRow = thead.insertRow();
					const headers = ['ID', 'Category', 'Summary'];
					headers.forEach(headerText => {
						const headerCell = document.createElement('th');
						headerCell.textContent = headerText;
						headerRow.appendChild(headerCell);
					});

					const tbody = table.createTBody();
					data.forEach(item => {
						const row = tbody.insertRow();
						var cell = row.insertCell();
						cell.innerHTML = `<a href="resume?id=${item.id}&category=${item.category}" target="_blank">${item.id}</a>`
						cell = row.insertCell();
						cell.innerText = item.category;
						cell = row.insertCell();
						cell.innerText = item.answer;
						/*const cellData = [
							item.id,
							item.category,
							item.answer
						];
						cellData.forEach((cellText, index) => {
							const cell = row.insertCell();
							if (index === 0) { // Assuming the Question field might contain HTML links
								cell.innerHTML = cellText;
							} else {
								cell.textContent = cellText;
							}
						});*/
					});

					resultsContainer.appendChild(table);
				}
			</script>	
				
		
        </div>		
        <div class="tab-pane" id="lab4">
            <h2>Combining AI: Transcribe Text and Augment Text</h2>
		

					<p>One of the cool things you can do with AI is combine models to create dynamic outcomes. Truthfully, RAG applications already do this with embedding models and gendrative models, but here you'll combine Whisper, an model used for speech to text with GPT3.5 to create a transcription.</p>
					
					<p><img style="width:500px" src="images/speech2text.png"></p>
					
					<p>The Whisper model is an automatic speech recognition (ASR) system developed by OpenAI, which leverages a transformer architecture to transcribe spoken language into text. Trained on a diverse set of data, including multiple languages and accents, it offers robust performance across various environments, even in noisy conditions. Whisper's end-to-end learning approach allows it to process raw audio input directly into written text, bypassing traditional intermediate transcription steps. The GPT supplements the model by refining the output from the audio transcription.</p>
					
					<p>Here, tell the GPT how you want to refine your transcription, like, "Make my transcription a poem," or "Make my transcription flow better with complete sentences and better punctuation." Tweak your prompts and and record again to see how things change.</p>
	


			
						

            <div class="mb-3">
                <textarea class="form-control" id="dictatePrompt" rows="4" placeholder="How do you  want to refine your transcription?"></textarea>
            </div>
            <div class="mb-3">
                <button class="btn btn-primary" id="startRecordBtn">Start Recording</button>
                <button class="btn btn-secondary" id="stopRecordBtn" disabled>Stop Recording</button>
            </div>			
            <h3 class="mt-4">Transcription:</h3>
            <p id="transcription"></p>
            <h3>Adaptation:</h3>
            <p id="formatted"></p>

			<script>
				let mediaRecorder;
				let audioChunks = [];

				document.getElementById('startRecordBtn').addEventListener('click', function() {
					navigator.mediaDevices.getUserMedia({ audio: true })
						.then(stream => {
							mediaRecorder = new MediaRecorder(stream);
							mediaRecorder.start();

							mediaRecorder.addEventListener("dataavailable", event => {
								audioChunks.push(event.data);
							});

							this.disabled = true;
							document.getElementById('stopRecordBtn').disabled = false;
						});
				});

				document.getElementById('stopRecordBtn').addEventListener('click', function() {
					mediaRecorder.stop();

					mediaRecorder.addEventListener("stop", () => {
						const audioBlob = new Blob(audioChunks, { type: 'audio/ogg' });
						sendAudioToServer(audioBlob);
						audioChunks = [];

						document.getElementById('startRecordBtn').disabled = false;
						this.disabled = true;
					});
				});

				function sendAudioToServer(blob) {
					const formData = new FormData();
					formData.append('file', blob, 'audio.ogg');
					formData.append('prompt', document.getElementById("dictatePrompt").value);

					fetch(baseUrl + '/dictate', {
						method: 'POST',
						body: formData
					})
					.then(response => response.json())
					.then(data => {
						document.getElementById('transcription').textContent = data.transcription;
						document.getElementById('formatted').textContent = data.formatted;
					})
					.catch(error => console.error('Error:', error));
				}
			</script>		
		
		
        </div>
    </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"></script>
</body>
</html>
